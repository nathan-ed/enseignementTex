\RequirePackage[most]{tcolorbox}
\tcbuselibrary{skins}
\RequirePackage{titlesec}  % For section numbering
\RequirePackage{ragged2e}  % For text alignment
\RequirePackage{hyperref}  % For clickable references
\RequirePackage{etoolbox}
\usepackage[french]{babel}
\RequirePackage[french=quotes]{csquotes}
\setquotestyle{french}
\RequirePackage{amsmath}
\RequirePackage{amsfonts}
\RequirePackage{qrcode}
\RequirePackage{amsthm}
\RequirePackage{varwidth}
\RequirePackage{systeme}
\RequirePackage{tikz}
\usetikzlibrary{patterns}
\RequirePackage{tkz-euclide}
\RequirePackage{pifont}
\RequirePackage[table]{xcolor}
\RequirePackage{interval}
\intervalconfig{separator symbol=;}
\RequirePackage{lscape}
\RequirePackage{bm}
\RequirePackage{array}
\RequirePackage{longtable}
\makeatletter
\IfFileExists{../packages/intervalles.sty}{%
  \RequirePackage{../packages/intervalles}%
}{%
  \IfFileExists{../../packages/intervalles.sty}{%
    \RequirePackage{../../packages/intervalles}%
  }{%
    \PackageError{intervalles}{Could not find intervalles.sty}{}
  }%
}
\makeatother
\RequirePackage{tabularray}
\RequirePackage{tabularx}
\UseTblrLibrary{booktabs}     % nice rules
\RequirePackage[top=1.8cm, bottom=1.7cm, left=1cm , right=1.5cm]{geometry}
\RequirePackage{nameref}
\RequirePackage{multicol}
\setlength\parindent{0pt}
\makeatletter
\newcommand*{\currentname}{\@currentlabelname}
\makeatother
% Define counters
\newcounter{exemple}
\newcounter{formule}
\newcounter{definition}
\newcounter{exercice}
\newcounter{remarque}
\newcounter{activite}
\newcounter{theo}
\newcounter{propo}
\newcounter{coro}
\newcounter{corri}

\titleformat{\section}[frame]
{\normalfont}
{\filright
\footnotesize
\enspace \Chapitre ~ SECTION ~ \thesection\enspace}
{8pt}
{\Large\bfseries\filcenter}

\newcommand{\cours}{1MA1~--~EG~--~ns~--~2024-2025}
\newcommand{\sourcecours}{}%{\footnotesize Source principale~: Sesamath 3e -- adaption libre.}}
\RequirePackage{fancyhdr}
\renewcommand{\sectionmark}[1]{ \markright{#1} }
\pagestyle{fancy}
\fancyhead[LE,RO]{
\slshape CC BY-SA
}

\fancyhead[LO,RE]{
\ifnum\value{page}=1
\slshape \Chapitre
\fi
\ifnum\value{page}>1
		\slshape \Chapitre~--~\slshape{\rightmark}
\fi
}
\fancyfoot[C]{\thepage/\pageref{LastPage}}
\fancyfoot[LE,RO]{\footnotesize Version du \today}
\fancyfoot[LO,RE]{\slshape{\cours}} 
\RequirePackage{../packages/fontes2}
\RequirePackage{fontawesome5}
\RequirePackage{pgffor}
\RequirePackage{pgfplots}

\RequirePackage{lastpage}
\RequirePackage{ifthen}
\RequirePackage{tasks}
\input{../macros/print_exo_theorie}

% Global tcolorbox settings
\tcbset{
    boxrule=0pt,    
    left=0pt, right=0pt,
    sharp corners,
    width=\linewidth,
    before skip=0pt, after skip=0pt,
    sidebyside, sidebyside gap=5mm,
    sidebyside align=top,
    righthand width=0.75\linewidth,
    lefthand width=0.25\linewidth,
    parbox=false,
    colback=white,
    fontupper=\raggedleft,  
    fontlower=\justifying,  
    colframe=white % No border
}

\newtcolorbox[auto counter]{exemple}[1][]{
	enhanced,
    before upper={\raggedleft\textbf{\stepcounter{exemple}Exemple~\theexemple}\\\vspace{0.5em}},
borderline west={0.5pt}{5cm}{black,
    line cap=round,
    shorten >=3mm,
    shorten <=3mm},
before lower={\setlength\parindent{0pt}},
    #1
}
\newtcolorbox[auto counter]{exemplesuite}[1][]{
	enhanced,
    before upper={\raggedleft\textbf{Exemple~\theexemple\\(suite)}\\\vspace{0.5em}},
borderline west={0.5pt}{5cm}{black,
    line cap=round,
    shorten >=3mm,
    shorten <=3mm},
before lower={\setlength\parindent{0pt}},
    #1
}

\newtcolorbox[auto counter]{autre}[1][]{
    before upper={},
    before lower={\setlength\parindent{0pt}},
    #1
}


\newtcolorbox[auto counter]{formule}[1][]{
    before upper={\raggedleft\textbf{\stepcounter{formule}Formule}\\\vspace{0.5em}},
    before lower={\setlength\parindent{0pt}},
    #1
}
\newtcolorbox[auto counter]{formules}[1][]{
    before upper={\raggedleft\textbf{\stepcounter{formule}Formules}\\\vspace{0.5em}},
    before lower={\setlength\parindent{0pt}},
    #1
}
\newtcolorbox[auto counter]{methode}[1][]{
    before upper={\raggedleft\textbf{Méthode}\\\vspace{0.5em}},
    before lower={\setlength\parindent{0pt}},
    #1
}
\newtcolorbox[auto counter]{notation}[1][]{
    before upper={\raggedleft\textbf{Notation}\\\vspace{0.5em}},
    before lower={\setlength\parindent{0pt}},
    #1
}

\newtcolorbox[auto counter]{definition}[1][]{
	enhanced,
    before upper={\raggedleft\textbf{Définition}\\\vspace{0.5em}},
borderline west={0.5pt}{5cm}{black,
    line cap=round,
    shorten >=3mm,
    shorten <=3mm},
    before lower={\setlength\parindent{0pt}},
 #1
}

\newtcolorbox[auto counter]{remarque}[1][]{
    before upper={\raggedleft\textbf{Remarque}\\\vspace{0.5em}},
   before lower={\setlength\parindent{0pt}},
    #1
}

\newtcolorbox[auto counter]{discussion}[1][]{
    before upper={\raggedleft\textbf{Discussion}\\\vspace{0.5em}},
   before lower={\setlength\parindent{0pt}},
    #1
}




\newtcolorbox[auto counter]{activite}[1][]{
	breakable,
    before upper={\raggedright\stepcounter{activite}\textbf{Activité~\theactivite}\\},
   before lower={\setlength\parindent{0pt}},
    #1
}

\newtcolorbox[auto counter]{thm}[1][]{
	enhanced,
    boxrule=1pt,    
    colframe=black, % No border
	before upper={\raggedleft\stepcounter{theo}\textbf{Théorème \thetheo}\\},
   before lower={\setlength\parindent{0pt}},
after skip=10pt,
    #1
}
\newtcolorbox[auto counter]{prop}[1][]{
	enhanced,
    boxrule=1pt,    
    colframe=black, % No border
	before upper={\raggedleft\stepcounter{propo}\textbf{Proposition \thepropo}\\},
   before lower={\setlength\parindent{0pt}},
after skip=10pt,
    #1
}

\newtcolorbox[auto counter]{coro}[1][]{
	enhanced,
    boxrule=1pt,    
    colframe=black, % No border
	before upper={\raggedleft\stepcounter{coro}\textbf{Corollaire \thecoro}\\},
   before lower={\setlength\parindent{0pt}},
after skip=10pt,
    #1
}
% Define the exercice environment
\newtcolorbox[auto counter]{corri}[1][]{ % #1 = difficulty (default 0), #2 = extra options
	enhanced,
    righthand width=0.9\linewidth,
    lefthand width=0.1\linewidth,
  fontupper=\footnotesize, % Set content font size
  fontlower=\footnotesize, % Set content font size
    before upper={
        \refstepcounter{corri}%
        \fbox{\raggedleft\textbf{Corrigé~\thecorri}}%
        \\ \vspace{0.5em}
    },
   before lower={\setlength\parindent{0pt}},
   #1
}

% Define the exercice environment
\newtcolorbox[auto counter]{exercice}[1][]{ % #1 = difficulty (default 0), #2 = extra options
	enhanced,
    before upper={
        \refstepcounter{exercice}%
        \fbox{\raggedleft\textbf{Exercice~\theexercice}}%
        %\\
        %\ifnum#1>0
        %    \foreach \i in {1,...,#1}{%
        %        {\small \faPepperHot}%
        %    }%
        %\fi
        \\ \vspace{0.5em}
    },
   before lower={\setlength\parindent{0pt}},
}
\DeclareEmphSequence{\bfseries\itshape}
\makeatletter
\def\myrulefill{\leavevmode\leaders\hrule height .7ex width 1ex depth -0.6ex\hfill\kern\z@}
\makeatother

\newcommand{\textLigne}[1]{\myrulefill {{\footnotesize ~#1}} \myrulefill\par}


\newenvironment{explanation}[1][0.5]
  {%
    % #1 ist der Anteil x für die erste Spalte (z.B. 0.5)
    \renewcommand{\arraystretch}{1.5}%
    \begin{longtable}{%
      >{\raggedright\arraybackslash}p{\dimexpr#1\textwidth\relax}%
      >{\raggedright\arraybackslash}p{\dimexpr\textwidth - #1\textwidth - 0.05\textwidth\relax}%
    }%
  }
  {%
    \end{longtable}%
  }

\renewenvironment{proof}{{\bfseries  Preuve.}}{\hfill$\square$}


\RequirePackage{eqparbox}
\makeatletter
\renewenvironment{cases}[1][l]{\matrix@check\cases\env@cases{#1}}{\endarray\right.}
\def\env@cases#1{%
  \let\@ifnextchar\new@ifnextchar
  \left\lbrace\def\arraystretch{1.2}%
  \array{@{}#1@{\quad}l@{}}}
\makeatother

\RequirePackage{icomma}
\RequirePackage{polynom}
\RequirePackage{tocloft}
\renewcommand{\contentsname}{Table des matières}
% Optional: reduce font size of the TOC
\renewcommand{\cftsecfont}{\small}
\renewcommand{\cftsubsecfont}{\footnotesize}
\renewcommand{\cfttoctitlefont}{\normalsize\bfseries}
\setcounter{tocdepth}{2}

\newcommand{\ligne}[1]{\makebox[#1cm]{\hrulefill}\hspace{1em}} 
\renewcommand{\ligne}[1]{\parbox[b][2em]{#1cm}{\makebox[#1cm]{\hrulefill}}\hspace{0.5em}}
\newcommand{\emptybox}{\fbox{\parbox[c][8mm]{8mm}{\ }}}
\newcommand{\boxt}[1]{\fbox{\parbox[c][8mm]{8mm}{\centering #1}}}
\pgfplotsset{
  /pgfplots/xlabel near ticks/.style={
     /pgfplots/every axis x label/.style={
        at={(ticklabel cs:0.9,0.05)},anchor=near ticklabel
     }
  },
  /pgfplots/ylabel near ticks/.style={
     /pgfplots/every axis y label/.style={
        at={(ticklabel cs:0.6,0.8)},anchor=near ticklabel}
     }
  }
\renewcommand\labelitemii{\bullet}

\newcommand{\checkBox}{\fbox{\rule{0pt}{1em}\hspace{1em}}} % simple square
\newcommand{\qrwithlabel}[2]{%
    \begin{minipage}{0.15\pagewidth} % Adjust width to fit 4 on a line
        \centering
        \textbf{#1} \\ % Description on top
	\smallskip
	\href{#2}
	{\qrcode[height=3cm]{#2}} % QR code with fixed height
    \end{minipage}%
}

\RequirePackage{comment}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Z}{\mathbb{Z}}
\sysaddeqsign{?}
\sysequivsign{?}{\stackrel{?}{=}}

\sysaddeqsign{!}
\sysequivsign{!}{\neq}

\newenvironment{solve}
 {%
\begin{equation*}
  \renewcommand{\arraystretch}{1.3}%
  \setlength{\arraycolsep}{0pt}%
  \begin{array}{
    >{\displaystyle}r   % right aligned
    >{\displaystyle{}}l % left aligned
    @{\hspace{4em}}     % spacing
    |                   % vertical rule
    @{\hspace{2em}}     % spacing
    >{\displaystyle}l  % comments
  }%
 }%
 {\end{array}
\end{equation*}}


\RequirePackage[inline, shortlabels]{enumitem}
% Inline Enumerations
\newlist{inumerate}{enumerate*}{1}
\setlist*[inumerate]{before=\vspace{6pt}\newline, align=right, afterlabel=\hspace{2pt}, itemjoin=\hspace{10pt}, label=\roman*)}
\newlist{inlineumerate}{enumerate*}{1}
\setlist*[inlineumerate]{before=\vspace{6pt}, afterlabel=\hspace{2pt}, itemjoin=\hspace{10pt}, label=\roman*)}
\setlist[enumerate]{label=\roman*)}

\newlist{myinlineenum}{enumerate*}{1}
\setlist*[myinlineenum]{before=\vspace{6pt}, align=right, afterlabel=\hspace{2pt}, itemjoin=\hspace{10pt}, label=\roman*)}


\RequirePackage{xparse}

% Create a wrapper that sets spacing dynamically
\NewDocumentEnvironment{MyInlineEnum}{m} % m = spacing argument
  {
    \begin{myinlineenum}[itemjoin=\hspace{#1}]
  }
  {
    \end{myinlineenum}
  }

\tikzset{
  annotated cuboid/.pic={
    \tikzset{%
      every edge quotes/.append style={midway, auto},
      /cuboid/.cd,
      #1
    }
    \draw [every edge/.append style={pic actions, densely dashed, opacity=.5}, pic actions]
    (0,0,0) coordinate (o) -- ++(-\cubescale*\cubex,0,0) coordinate (a) -- ++(0,-\cubescale*\cubey,0) coordinate (b) edge coordinate [pos=1] (g) ++(0,0,-\cubescale*\cubez)  -- ++(\cubescale*\cubex,0,0) coordinate (c) -- cycle
    (o) -- ++(0,0,-\cubescale*\cubez) coordinate (d) -- ++(0,-\cubescale*\cubey,0) coordinate (e) edge (g) -- (c) -- cycle
    (o) -- (a) -- ++(0,0,-\cubescale*\cubez) coordinate (f) edge (g) -- (d) -- cycle;
    \path [every edge/.append style={pic actions, |-|}]
    (b) +(0,-5pt) coordinate (b1) edge ["\cubex \cubeunits"'] (b1 -| c)
    (b) +(-5pt,0) coordinate (b2) edge ["\cubey \cubeunits"] (b2 |- a)
    (c) +(3.5pt,-3.5pt) coordinate (c2) edge ["\cubez \cubeunits"'] ([xshift=3.5pt,yshift=-3.5pt]e)
    ;
  },
  /cuboid/.search also={/tikz},
  /cuboid/.cd,
  width/.store in=\cubex,
  height/.store in=\cubey,
  depth/.store in=\cubez,
  units/.store in=\cubeunits,
  scale/.store in=\cubescale,
  width=10,
  height=10,
  depth=10,
  units=cm,
  scale=.1,
}
\RequirePackage{siunitx}
\sisetup{locale = FR, per-mode = symbol, range-phrase=--, range-units=single, product-units=single}
\newcommand{\da}[1]{\SI[mode=text]{#1}{}}
\newcommand{\tunit}[2]{\SI[mode=text]{#1}{#2}}
\newcommand{\nunit}[1]{\SI[mode=text]{}{#1}}
